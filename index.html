<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Winkel TV</title>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        background: #000;
        overflow: hidden;
        font-family: 'Segoe UI', sans-serif;
        color: white;
      }

      /* Ana layout: video solda %75, borsa paneli saÄŸda %25 */
      #layout {
        display: flex;
        height: 100vh;
        width: 100vw;
      }

      #video-container {
        position: relative;
        width: 75%;
        height: 100%; /* YÃ¼ksekliÄŸi 100% yap */
        background: black;
      }

      video {
        width: 100%;
        height: 100%;
        object-fit: contain;
        background: black;
      }

      /* --- YENÄ°: Oynat Butonu Stili --- */
      #play-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.6);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10;
        cursor: pointer;
      }
      #playButton {
        font-size: 24px;
        padding: 15px 30px;
        background: #00ffcc;
        color: #111;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      /* --- BitiÅŸ: Oynat Butonu Stili --- */


      /* Saat ve bilgi overlay */
      .overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        background: rgba(0,0,0,0.4);
        padding: 8px 12px;
        font-size: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 5; /* Butonun altÄ±nda kalsÄ±n */
      }

      /* SaÄŸdaki borsa paneli */
      #sidebar {
        width: 25%;
        height: 100vh; /* Tam yÃ¼kseklik */
        background: #111;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        padding: 12px;
        box-sizing: border-box;
        border-left: 2px solid #222;
        overflow-y: auto; /* Gerekirse kaydÄ±rma Ã§ubuÄŸu */
      }

      #sidebar h3 {
        text-align: center;
        margin-bottom: 10px;
      }

      .stock {
        display: flex;
        justify-content: space-between;
        margin: 6px 0;
        font-size: 16px;
      }

      /* Alttaki kayan kurlar */
      #ticker {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        background: rgba(255,255,255,0.1);
        color: #00ffcc;
        white-space: nowrap;
        overflow: hidden;
        z-index: 20; /* Her zaman en Ã¼stte */
      }

      #ticker span {
        display: inline-block;
        padding-left: 100%;
        animation: scroll 25s linear infinite;
      }

      @keyframes scroll {
        from { transform: translateX(0); }
        to { transform: translateX(-100%); }
      }
    </style>
  </head>
  <body>
    <div id="layout">
      <div id="video-container">
        
        <video id="player"></video>

        <div id="play-overlay">
            <button id="playButton">â–¶ OYNAT</button>
        </div>

        <div class="overlay">
          <div id="info">Winkel TV</div>
          <div id="clock"></div>
        </div>
      </div>

      <div id="sidebar">
        <h3>Borsa CanlÄ±</h3>
        <div id="stocks"></div>
      </div>
    </div>

    <div id="ticker"><span id="ticker-text">YÃ¼kleniyor...</span></div>

    <script>
      // !!! Ã‡OK Ã–NEMLÄ°: DONMA SORUNU Ã‡Ã–ZÃœMÃœ !!!
      // "winkeltv.dpdns.org" adresi ev/ofis internetinizdir ve YAVAÅžTIR.
      // Buraya Cloudflare R2 panelinizden aldÄ±ÄŸÄ±nÄ±z ...pub.r2.dev adresinizi yazÄ±n.
      const BASE_URL = "https://winkeltv.dpdns.org";
      const PLAYLIST_URL = `${BASE_URL}/videos.json`;
      const FINANCE_API_URL = "https://api.finans.truncgil.com/v4/sondurumbilgileri";
      const player = document.getElementById("player");
      const clock = document.getElementById("clock");
      const stocksDiv = document.getElementById("stocks");
      const tickerText = document.getElementById("ticker-text");

      // YENÄ°: Buton elemanlarÄ±
      const playButton = document.getElementById("playButton");
      const playOverlay = document.getElementById("play-overlay");

      let playlist = [];
      let index = 0;

      // ðŸ•’ Saat
      function updateClock() {
        clock.textContent = new Date().toLocaleTimeString("tr-TR");
      }
      setInterval(updateClock, 1000);
      updateClock();

      // ðŸŽ¬ Video oynatma
      async function loadPlaylist() {
        try {
          const res = await fetch(PLAYLIST_URL);
          const data = await res.json();
          playlist = data.videos || [];
          if (playlist.length > 0) {
            // DEÄžÄ°ÅžÄ°KLÄ°K: Videoyu hemen baÅŸlatma, sadece ilk videoyu yÃ¼kle
            index = 0;
            const videoUrl = `${BASE_URL}/${playlist[index].name}`;
            player.src = videoUrl;
            // playVideo(0); // Bu satÄ±r kaldÄ±rÄ±ldÄ±
          }
        } catch (err) {
          console.error("Video listesi yÃ¼klenemedi:", err);
        }
      }

      function playVideo(i) {
        index = i;
        const videoUrl = `${BASE_URL}/${playlist[index].name}`; 
        player.src = videoUrl;
        player.play().catch(console.error);
      }

      player.addEventListener("ended", () => {
        index = (index + 1) % playlist.length;
        playVideo(index);
      });

      loadPlaylist();

      // YENÄ°: Butona tÄ±klayÄ±nca videoyu sesli baÅŸlatma
      playButton.addEventListener("click", () => {
        player.play().then(() => {
          // Oynatma baÅŸarÄ±lÄ± olursa butonu gizle
          playOverlay.style.display = "none";
        }).catch(err => {
          console.error("Video baÅŸlatÄ±lamadÄ±:", err);
        });
      });


      // ðŸ“Š Sahte borsa verisi (Ã¶rnek)
      const stocks = [];

      function formatApiData(apiData) {
        const filteredData = [];
        const itemsToGet = {
          "USDTRY": "USD/TRY",
          "EURTRY": "EUR/TRY",
          "gram-altin": "ALTIN (GR)",
          "GBPTRY": "GBP/TRY",
          "BIST100": "BIST 100" // Bu API BIST 100'Ã¼ destekliyorsa
        };

        for (const key in itemsToGet) {
          const item = apiData.find(d => d.Symbol === key);
          if (item) {
            filteredData.push({
              name: itemsToGet[key],
              value: parseFloat(item.Price),
              change: parseFloat(item.ChangeRate)
            });
          }
        }
        return filteredData;
      }

      // ðŸ“Š SaÄŸdaki paneli gÃ¼ncelle
      function renderStocks() {
        if (stocks.length === 0) {
            stocksDiv.innerHTML = "Veriler yÃ¼kleniyor...";
            return;
        }
        
        stocksDiv.innerHTML = stocks.map(s => `
          <div class="stock">
            <span>${s.name}</span>
            <span style="color:${s.change >= 0 ? '#0f0' : '#f33'}">
              ${s.value.toFixed(2)} (${s.change >= 0 ? 'â–²' : 'â–¼'}${Math.abs(s.change)}%)
            </span>
          </div>
        `).join('');
      }

      // ðŸ’± Alttaki kayan kurlarÄ± gÃ¼ncelle
      function updateTicker() {
        if (stocks.length === 0) {
            tickerText.textContent = "YÃ¼kleniyor...";
            return;
        }
        tickerText.textContent = stocks.map(s =>
          `${s.name}: ${s.value.toFixed(2)} (${s.change >= 0 ? 'â–²' : 'â–¼'}${Math.abs(s.change)}%)`
        ).join(" | ");
      }

      // ðŸš€ Ana Veri YÃ¼kleme Fonksiyonu
      async function loadFinancialData() {
        console.log("Finans verileri Ã§ekiliyor...");
        try {
          const res = await fetch(FINANCE_API_URL);
          if (!res.ok) throw new Error('API yanÄ±t vermiyor');
          
          const data = await res.json();
          
          // Gelen veriyi iÅŸle ve global 'stocks' dizisini gÃ¼ncelle
          stocks = formatApiData(data);
          
          // Veriler geldiÄŸine gÃ¶re ÅŸimdi ekrana yazdÄ±rabiliriz
          renderStocks();
          updateTicker();
          
        } catch (err) {
          console.error("Finans verisi Ã§ekilemedi:", err);
          stocksDiv.innerHTML = "<span style='color:#f33'>Veri alÄ±namadÄ±.</span>";
          tickerText.textContent = "Finans verileri yÃ¼klenemedi.";
        }
      }

      // --- SAYFA AÃ‡ILIÅžI ---

      // 1. Sahte veriyi kaldÄ±rÄ±p, ilk veriyi Ã§ek
      loadFinancialData();
      
      // 2. Her 5 dakikada bir (300,000 milisaniye) verileri otomatik gÃ¼ncelle
      setInterval(loadFinancialData, 300000);
    </script>
  </body>
</html>
